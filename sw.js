(function(){"use strict";const t="v20210225";const e=t+"::jsnmrs:";const s=e+"static";const l=e+"pages";const c=e+"images";const a=["/","/bikes/twenty-years-later/","/code/rotating-ssh-keys/","/offline/"];const n=["/fonts/ssp.woff2","/img/jason-iceland-320.jpg","/img/twenty-240.jpg","/apple-touch-icon.png"];function i(){return caches.open(s).then(e=>{e.addAll(a.map(e=>new Request(e,{credentials:"include"})));return e.addAll(n.map(e=>new Request(e,{credentials:"include"})))})}function f(e,t,n){caches.open(e).then(e=>e.put(t,n))}function r(n,i){caches.open(n).then(t=>{t.keys().then(e=>{if(e.length>i){t.delete(e[0]).then(r(n,i))}})})}function o(){return caches.keys().then(e=>{return Promise.all(e.filter(e=>e.indexOf(t)!==0).map(e=>caches.delete(e)))})}self.addEventListener("message",e=>{if(e.data.command=="trimCaches"){r(l,35);r(c,20)}});self.addEventListener("install",e=>{e.waitUntil(i().then(()=>self.skipWaiting()))});self.addEventListener("activate",e=>{e.waitUntil(o().then(()=>self.clients.claim()))});self.addEventListener("fetch",e=>{let n=e.request;let i=new URL(n.url);if(n.method!=="GET"){return}if(n.url.indexOf("?")!==-1){return}if(n.headers.get("Accept").indexOf("text/html")!==-1){e.respondWith(fetch(n).then(e=>{let t=e.clone();if(a.includes(i.pathname)||a.includes(i.pathname+"/")){f(s,n,t)}else{f(l,n,t)}return e}).catch(()=>{return caches.match(n).then(e=>e||caches.match("/offline/"))}));return}if(n.headers.get("Accept").indexOf("video")!==-1){e.respondWith(caches.match(n).then(e=>{return e||fetch(n).then(t=>{if(n.headers.get("Accept").indexOf("image")!==-1){let e=t.clone();f(c,n,e)}return t}).catch(()=>{if(n.headers.get("Accept").indexOf("image")!==-1){return new Response('<svg role="img" aria-labelledby="offline-title" viewBox="0 0 400 300" xmlns="http://www.w3.org/2000/svg"><title id="offline-title">Offline</title><g fill="none" fill-rule="evenodd"><path fill="#f9f9f9" d="M0 0h400v300H0z"/><text fill="#777777" font-family="Source Serif Pro, Times, serif" font-size="72" font-weight="bold"><tspan x="93" y="172">offline</tspan></text></g></svg>',{headers:{"Content-Type":"image/svg+xml","Cache-Control":"no-store"}})}})}))}})})();