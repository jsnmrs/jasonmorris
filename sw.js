(function(){"use strict";const t="v20210225",e=t+"::jsnmrs:",s=e+"static",l=e+"pages",a=e+"images",c=["/","/bikes/twenty-years-later/","/code/rotating-ssh-keys/","/offline/"],n=["/fonts/ssp.woff2","/img/jason-iceland-320.jpg","/img/twenty-240.jpg","/apple-touch-icon.png"];function i(){return caches.open(s).then(e=>{e.addAll(c.map(e=>new Request(e,{credentials:"include"})));return e.addAll(n.map(e=>new Request(e,{credentials:"include"})))})}function r(e,t,n){caches.open(e).then(e=>e.put(t,n))}function f(n,i){caches.open(n).then(t=>{t.keys().then(e=>{if(e.length>i){t.delete(e[0]).then(f(n,i))}})})}function h(){return caches.keys().then(e=>{return Promise.all(e.filter(e=>e.indexOf(t)!==0).map(e=>caches.delete(e)))})}self.addEventListener("message",e=>{if(e.data.command==="trimCaches"){f(l,35);f(a,20)}});self.addEventListener("install",e=>{e.waitUntil(i().then(()=>self.skipWaiting()))});self.addEventListener("activate",e=>{e.waitUntil(h().then(()=>self.clients.claim()))});self.addEventListener("fetch",e=>{let n=e.request,i=new URL(n.url);if(n.method!=="GET"){return}if(n.url.indexOf("?")!==-1){return}if(n.headers.get("Accept").indexOf("text/html")!==-1){e.respondWith(fetch(n).then(e=>{let t=e.clone();if(c.includes(i.pathname)||c.includes(i.pathname+"/")){r(s,n,t)}else{r(l,n,t)}return e}).catch(()=>{return caches.match(n).then(e=>e||caches.match("/offline/"))}));return}if(n.headers.get("Accept").indexOf("video")!==-1){e.respondWith(caches.match(n).then(e=>{return e||fetch(n).then(t=>{if(n.headers.get("Accept").indexOf("image")!==-1){let e=t.clone();r(a,n,e)}return t}).catch(()=>{if(n.headers.get("Accept").indexOf("image")!==-1){return new Response('<svg role="img" aria-labelledby="offline-title" viewBox="0 0 400 300" xmlns="http://www.w3.org/2000/svg"><title id="offline-title">Offline</title><g fill="none" fill-rule="evenodd"><path fill="#f9f9f9" d="M0 0h400v300H0z"/><text fill="#777777" font-family="Source Serif Pro, Times, serif" font-size="72" font-weight="bold"><tspan x="93" y="172">offline</tspan></text></g></svg>',{headers:{"Content-Type":"image/svg+xml","Cache-Control":"no-store"}})}return false})}))}})})();